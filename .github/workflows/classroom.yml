name: Autograding Tests
'on':
- push
- repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read
env:
  PROJECT_DIR: ''
jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Find project directory
      id: find-dir
      run: |
        # Find the first directory matching 'lab*' or 'hw*'
        PROJECT_DIR=$(find . -maxdepth 1 -type d \( -name "lab*" -o -name "hw*" \) | head -n 1)
        if [ -z "$PROJECT_DIR" ]; then
          echo "No matching directory found!" >&2
          exit 1
        fi
        echo "PROJECT_DIR=${PROJECT_DIR}" >> $GITHUB_ENV
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '25'
    - name: Test Item price field
      id: test-item-price
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test Item price field
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.item_has_price_field_with_getter_and_setter -p gradle-tests"
        timeout: 10
        max-score: 5
    - name: Test Item amount field
      id: test-item-amount
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test Item amount field
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.item_has_amount_field_with_getter_and_setter -p gradle-tests"
        timeout: 10
        max-score: 5
    - name: Test Add button exists
      id: test-add-button
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test Add button exists
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.dashboard_has_add_button -p gradle-tests"
        timeout: 10
        max-score: 5
    - name: Test Report button exists
      id: test-report-button
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test Report button exists
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.dashboard_has_report_button -p gradle-tests"
        timeout: 10
        max-score: 5
    - name: Test DetailView has price and amount fields
      id: test-detailview-fields
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test DetailView has price and amount fields
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.detail_view_has_price_and_amount_fields -p gradle-tests"
        timeout: 10
        max-score: 7
    - name: Test validation for empty name
      id: test-validation-name
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test validation for empty name
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.save_button_validates_non_empty_name -p gradle-tests"
        timeout: 10
        max-score: 10
    - name: Test validation for negative price
      id: test-validation-price
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test validation for negative price
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.save_button_validates_non_negative_price -p gradle-tests"
        timeout: 10
        max-score: 10
    - name: Test validation for negative amount
      id: test-validation-amount
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test validation for negative amount
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.save_button_validates_non_negative_amount -p gradle-tests"
        timeout: 10
        max-score: 10
    - name: Test ReportView displays total amount label
      id: test-reportview-display
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test ReportView displays total amount label
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.report_button_opens_report_view -p gradle-tests"
        timeout: 10
        max-score: 7
    - name: Test ReportView shows total price label
      id: test-reportview-total-price-label
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test ReportView shows total price label
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.report_view_shows_total_price -p gradle-tests"
        timeout: 10
        max-score: 7
    - name: Test ReportView has OK button
      id: test-reportview-ok-button
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test ReportView has OK button
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.report_view_has_ok_button -p gradle-tests"
        timeout: 10
        max-score: 7
    - name: Test ReportView correct total amount
      id: test-reportview-correct-amount
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test ReportView correct total amount
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.report_view_shows_correct_total_amount -p gradle-tests"
        timeout: 10
        max-score: 9
    - name: Test ReportView correct total price
      id: test-reportview-correct-price
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test ReportView correct total price
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.report_view_shows_correct_total_price -p gradle-tests"
        timeout: 10
        max-score: 8
    - name: Test FlatLaf Look and Feel
      id: test-flatlaf
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Test FlatLaf Look and Feel
        setup-command: ''
        command: "xvfb-run --auto-servernum ./gradle-tests/gradlew test --tests org.test.AppTest.application_uses_flatlaf_look_and_feel -p gradle-tests"
        timeout: 10
        max-score: 5
    - name: Autograding Reporter
      uses: classroom-resources/autograding-grading-reporter@v1
      env:
        TEST-ITEM-PRICE_RESULTS: "${{ steps.test-item-price.outputs.result }}"
        TEST-ITEM-AMOUNT_RESULTS: "${{ steps.test-item-amount.outputs.result }}"
        TEST-ADD-BUTTON_RESULTS: "${{ steps.test-add-button.outputs.result }}"
        TEST-REPORT-BUTTON_RESULTS: "${{ steps.test-report-button.outputs.result }}"
        TEST-DETAILVIEW-FIELDS_RESULTS: "${{ steps.test-detailview-fields.outputs.result }}"
        TEST-VALIDATION-NAME_RESULTS: "${{ steps.test-validation-name.outputs.result }}"
        TEST-VALIDATION-PRICE_RESULTS: "${{ steps.test-validation-price.outputs.result }}"
        TEST-VALIDATION-AMOUNT_RESULTS: "${{ steps.test-validation-amount.outputs.result }}"
        TEST-REPORTVIEW-DISPLAY_RESULTS: "${{ steps.test-reportview-display.outputs.result }}"
        TEST-REPORTVIEW-TOTAL-PRICE-LABEL_RESULTS: "${{ steps.test-reportview-total-price-label.outputs.result }}"
        TEST-REPORTVIEW-OK-BUTTON_RESULTS: "${{ steps.test-reportview-ok-button.outputs.result }}"
        TEST-REPORTVIEW-CORRECT-AMOUNT_RESULTS: "${{ steps.test-reportview-correct-amount.outputs.result }}"
        TEST-REPORTVIEW-CORRECT-PRICE_RESULTS: "${{ steps.test-reportview-correct-price.outputs.result }}"
        TEST-FLATLAF_RESULTS: "${{ steps.test-flatlaf.outputs.result }}"
      with:
        runners: test-item-price,test-item-amount,test-add-button,test-report-button,test-detailview-fields,test-validation-name,test-validation-price,test-validation-amount,test-reportview-display,test-reportview-total-price-label,test-reportview-ok-button,test-reportview-correct-amount,test-reportview-correct-price,test-flatlaf
